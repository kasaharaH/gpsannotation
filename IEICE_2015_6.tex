%% 1. 「論文」
%% v1.6 [2009/11/03]
\documentclass[paper]{ieicej}
\usepackage{graphicx}
%\usepackage{latexsym}
%\usepackage[fleqn]{amsmath}
%\usepackage[psamsfonts]{amssymb}
\usepackage{amsmath}
%\usepackage{algorithm2e}
%\usepackage{algorithmic}
\setcounter{page}{1}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{bm}

\jtitle{環境制約を用いた旅行者GPS軌跡からの移動モード推定手法}
\jsubtitle{}
\etitle{Transportation Mode Annotation of Tourists' GPS Trajectories Under Environmental Constraints}
\authorlist{%
 \authorentry[hidekazu.kasahara@mm.media.kyoto-u.ac.jp]{笠原 秀一}{Hidekazu KASAHARA}{Kyoto}% <= 記述しないとエラーになります
 \authorentry{飯山 将晃}{Masaaki Iiyama}{Kyoto}
 \authorentry{森 幹彦}{Mikihiko MORI}{Kyoto}
 \authorentry{椋木 雅之}{Masayuki MUKUNOKI}{Miyazaki} 
 \authorentry{美濃 導彦}{Michihiko Minoh}{Kyoto}
% \authorentry{笠原 秀一}{Hidekazu KASAHARA}{Kyoto}
 %\authorentry{和文著者名}{英文著者名}{所属ラベル}[現在の所属ラベル]
}
\affiliate[Kyoto]{京都大学学術情報メディアセンター，〒606-8501京都府京都市左京区吉田二本松町}{Academic Center for Computing and Media Studies，Kyoto University，Yoshida Nihonmatsu-cho，Sakyo-ku，606-8501 Japan}
\affiliate[Miyazaki]{宮崎大学工学教育研究部情報システム工学科，〒889-2192 宮崎県宮崎市学園木花台西1-1}{Faculty of Engineering, Department of Computer Science and Systems Engineering, University of Miyazaki，1-1, Gakuen Konohana-dai Nishi，Miyzaki shi，889-2192, Japan}

\begin{document}
\begin{abstract}
観光地の企業や自治体にとって，旅行者がどのような手段で移動しているのかを知ることは，政策立案上重要である．
こうした情報は緯度経度の時系列で表される旅行者移動軌跡の移動モードを推定する事で得られる．
従来，旅行者の速度の特徴量を用いて機械学習で移動モードを推定する研究が行われてきたが，車両や列車の一時的な減速や停止を徒歩モードと誤推定してしまうことが避けられなかった．
駅やバス停のような一時的減速が生じる場所は既知であり，これを環境制約として用いることで誤推定を減らすことができる．
本研究では，多数の観光スポットを有する大規模観光地内を徒歩・公共交通機関で移動する旅行者を想定し，環境制約を用いてGPS移動軌跡から移動モードを推定する．
手法の精度を人間が移動モードをラベリングした結果と比較して評価し，提案手法の有効性を確認した．

\end{abstract}
\begin{keyword}
GPS，環境制約，ラベリング，移動軌跡
\end{keyword}
\begin{eabstract}
%英文アブストラクト 100 words
Analysis of transportation mode used by tourists provides basic information for tourism policy making. With the technical advances of tracking devices, GPS smartphones sense the movement of tourists, and generate a large volumes of data which show tourists' trajectory data. Many researchers study GPS transportation mode annotation by using machine learning. In this research, we propose a new GPS transportation mode annotation method using environmental constraints without machine learning. We assume that tourists move by foot or public transportations in the large-size touristic destinations which include many touristic spots.
\end{eabstract}
\begin{ekeyword}
GPS，environmental constraint，labelling，semantic annotation
\end{ekeyword}
\maketitle

\section{まえがき}
旅行者がどのような手段で移動しているのかを知ることは，観光地の企業や自治体が観光政策やマーケティング戦略を立案する上で重要である．
こうした情報は，緯度経度の時系列で表される旅行者の移動軌跡の移動のモードを推定する事で得られる．
移動モードを含め，旅行者の行動測定には，
伝統的な調査票・インタビューでの聞き取りや，交通機関の乗降者数調査，宿泊者数調査などが利用されてきたが，
GPSをはじめとするセンサを備えた携帯情報端末の普及により，
GPS移動軌跡として旅行者行動を安価かつ詳細に測定することが可能になった．
GPS移動軌跡は基本的には緯度経度と時刻しか含んでいないので，
何らかの手段を用いて移動モードに関するセマンティックな情報を付与する必要がある．
これをGPS移動軌跡へのセマンティックアノテーション\cite{Guc}と呼ぶ．\par
移動モードの推定手法としては，旅行者の速度の特徴量を用いて機械学習で推定する手法が研究されている\cite{Hemminki,Bolbol}．
しかし，
列車や路線バスが駅やバス停で一時的に減速$/$停止するため，
速度の情報だけではより低速の別の移動モードに誤推定する問題が避けられない．
列車や路線バスが一時的減速を行う駅やバス停といった場所は既知であるので，
これを環境制約として利用すれば，一時的減速時でも観測点の移動モードを正しく推定できると考えられる．
本研究では，
環境制約を用いてGPS移動軌跡から移動モードを推定する手法を提案する．

本稿の構成は以下の通りである．
第2章では従来研究に対する我々の研究の位置づけ，
第3章では提案手法で用いる環境制約について述べる．
第4章では提案手法の詳細を説明し，
第5章では提案手法を評価するために実施した実験とその結果について述べる．
第6章では実験結果の考察を行い，
第7章で全体のまとめとする．

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table*}[tbh]
  \centering
  \caption{速度と環境制約の組み合わせによる移動モードの解釈}
    \begin{tabular}{ccccccccccc}
    \toprule[1pt]
    \multicolumn{2}{c}{\multirow{4}[8]{*}{}} & \multicolumn{9}{c}{環境制約$e$} \\  \cmidrule(r){3-11}
    \multicolumn{2}{c}{} & \multicolumn{2}{c}{点} & \multicolumn{5}{c}{線} & \multicolumn{2}{c}{面} \\  \cmidrule(r){3-4}\cmidrule(r){5-9}\cmidrule(r){10-11}
    \multicolumn{2}{c}{} & \multirow{2}[4]{*}{停留点} & \multirow{2}[4]{*}{交差点} & \multicolumn{2}{c}{道路} & \multirow{2}[4]{*}{線路} & \multirow{2}[4]{*}{歩道} & \multirow{2}[4]{*}{自転車道} & \multirow{2}[4]{*}{観光地} & \multirow{2}[4]{*} {駐車場} \\ \cmidrule(r){5-6}
    \multicolumn{2}{c}{} &   （駅・バス停など）     &      & 路線バス経路 & それ以外  &       &       &       &       &  \\ \cmidrule(r){3-4}\cmidrule(r){5-9}\cmidrule(r){10-11}
    \multirow{6}[12]{*}& 徒歩     & 低速     & 低速       & 低速   & 低速   & ×     & 低速   & ×     & 低速   & 低速 \\
                       & 自転車   & 低〜中速 & 低〜中速   & 低〜中速   & 低〜中速   & ×     & ×     & 低〜中速   & ×     & 低速 \\
                       & バイク   & 高速     & 低〜高速   & 高速   & 高速   & ×     & ×     & ×    & ×     & 低速 \\
    {移動モード$m$}    & 路線バス & 低速     & 低〜高速   & 高速   & 高速   & ×     & ×     & ×     & ×     & × \\
                       & バス以外の自動車 & 高速     & 低〜高速   & 高速   & 高速   & ×     & ×     & ×     & ×     & 低速 \\
                                              & (タクシー等) &      &    &    &    &      &      &      &      &  \\

                       & 列車     & 低速     & ×         & ×     & ×     & 高速   & ×     & ×     & ×     & × \\
%                       & ・・・   & ・・・   & ・・・     & ・・・ & ・・・ & ・・・ & ・・・ & ・・・& ・・・ & ・・・ \\
    \bottomrule[1pt]
    \end{tabular}%
  \label{tab:env}%
\end{table*}%

\section{従来研究に対する位置づけ}
%移動モード推定のアプローチについて
移動モード推定のアプローチは，
観測対象に属する特徴量を用いて移動モードを推定する手法と，
観測対象に属さない情報を推定に取り入れた手法に分類される．

%観測対象に属する特徴量で移動モードを推定する手法の概要と問題点
観測対象に属する特徴量で移動モードを推定する手法では，
訓練データから得た特徴量の学習によって推定を行う．
決定木\cite{Aoki,Zheng}や階層的CRF\cite{Liao}，SVM\cite{Bolbol,Zheng}といった機械学習手法を速度に適用した研究が行われている．
既に述べたとおり，
路線バスや列車が駅やバス停，混雑などを原因として一時的に減速すると，
速度ではより低速の徒歩と区別することが難しくなる．
%加速度を用いた手法
速度以外にも，携帯情報端末に搭載されている加速度計を用いて測定した走行時の振動により，
ベイズ理論を用いて車とバイクの識別を行う手法\cite{ohashi}や，
3軸の加速度センサから得られる加速度にアダプティブブースティングを適用して移動手段の推定を行う手法\cite{Hemminki}も行われているが，
これらのセンサ情報は特別に取得しないと得られない．
GPSによる移動軌跡データは一般に広く使われており入手が容易であるため，
本研究ではGPSから得られた移動軌跡を用いる．

%観測対象に属さない情報を推定に取り入れた手法の概要
観測対象に属さない情報を推定に取り入れた手法として，
交通ネットワークや土地利用状況といった地理空間情報を利用する手法が提案されている\cite{Stenneth,Yan2013}．\par

%Yanの手法の概要
Yan\cite{Yan2013}らは，GPS移動軌跡を移動と停止の部分列に分割し，
それぞれの部分列がどのような行動を意味しているかを推定する手法を提案している．
移動の部分列推定の出力が移動モードであり，停止の部分列推定の出力が出来事である．
Yanらの手法では，GPS移動軌跡を入力とし，ノイズを除去した後に，
速度や加速度，移動方向といった時空間特徴量を用いてGPS移動軌跡を部分列に分割する．
それぞれの部分列が意味する移動モードと出来事を，
路線バス経路や地下鉄経路といった道路のタイプや土地の利用状況といった外部データを用いて推定し，
結果として出力する．

%Yanの手法の問題点
しかし，Yanらは停止部分列での出来事の推定に注力しており，
移動モードの推定の具体的な手法については記述されていない．
道路タイプと移動モードを単純に一対一対応させているだけと考えられる．

%Stennethの手法の概要
Stenneth\cite{Stenneth}らは，
地域内の全ての路線バスのリアルタイム位置情報，鉄道経路・バス停の位置情報と観測対象とのユークリッド距離を算出して特徴量とすることで，
観測対象に属さない情報を推定に取り入れる手法を提案している．
このうち路線バスのリアルタイム位置情報については，全ての路線バスとの平均距離と，
観測対象との距離の合計が最小となる路線バスとの平均距離の2つを特徴量として用いている．
これらに観測対象の速度，加速度，方向変化，GPS精度を加えた8つをランダムフォレスト機械学習の特徴量として，各観測点における移動モードを推定している．

%Stennethの手法の問題点
Stennethらは，
地理空間情報を取り入れて特徴量を増やすことで，
機械学習の精度を向上させている．
しかし，
路線バスとの距離を2つ用いたり，GPS精度を特徴量として用いている理由は不明確である．
また，
全ての路線バスのリアルタイム位置情報が利用できるのであれば，
観測対象が利用している路線バスを高い精度で判定できると考えられるが，
そうした地理空間の特性を考慮していない．
%提案手法との違い
Stennethらの手法とは異なり，
提案手法では観測点が属する地理空間によって速度の解釈を変更することで移動モードを推定している．
GPS移動軌跡の推定の分野ではこのような手法は従来行われていない．

\begin{figure}[t]
\begin{center}
 \includegraphics[width=70mm]{envtmnt_rev.eps}
\end{center}
\caption{静的環境制約と動的環境制約}
\label{env}
%\ecaption{Environmental Constraints}
\end{figure}

\section{環境制約}

%環境制約の定義
地理空間上での移動には，環境に存在する要因によって生じる様々な制約がある．
場所や時間によって移動モードが取り得る速度には制約があり，
移動モードによっては移動できる経路に制約がある．
本研究ではこうした環境に起因する移動への制約を環境制約$e$と定義する．

環境制約$e$は地理空間上の点，線，面として存在している．
点の環境制約としては駅や停留点（駅や路線バスの停留所），
線の環境制約としては道路や線路，歩道，自転車道，
面の環境制約としては観光地や駐車場がある．
環境制約$e$は複数存在し，互いに素ではなく,
線路と駅のように一つの観測点に対して同時に与えられる環境制約$e$もある．
そのため，GPS移動軌跡の観測点$i$には,
地理空間上の位置を基準に，
全ての環境制約について有無を示す値$a_1, a_2, a_3, \cdots，a_l(lは環境制約数)$の集合$A_i$を付与する．

%速度制約を用いた観測点における移動モード推定
速度を用いてGPS緯度軌跡に属する観測点から移動モードを推定する際には，
環境制約$e$によって生じる速度変化を考慮しないと正しく解釈できない．
環境制約$e$に応じて速度を解釈する必要がある．
環境制約$e$と速度の組み合わせによる移動モード$m$の解釈を表\ref{tab:env}に示す．
なお，
組み合わせによっては移動モード$m$がどのような速度も取り得ない場合があり，
表\ref{tab:env}では×で示した．

%速度制約の問題点とコンテクストを用いたセグメントにおける移動モード推定
複数の移動モードが取り得る速度の範囲が類似している場合，
一つの観測点$i$における環境制約$e_i$と速度だけでは推定できないので，
近傍との連結性と経路制約を用いて移動モードを推定する．
本研究ではこれら二つをコンテクストと呼ぶ．

%静的環境制約と動的環境制約，経路制約と速度制約の分類
ここまで，環境制約$e$は時間に対して不変として扱ってきた．
実際には，時間によって観測点$i$に付与する制約が変化する動的環境制約と，
変化しない静的環境制約がある(図\ref{env})．
例えば，週末のみ歩行者天国になる道路では，
平日は道路としての環境制約を付与し，
週末は歩道としての環境制約を付与する．

%環境制約に関する情報の入手の容易さ
列車経路や路線バス経路といった静的環境制約の多くは，
その位置情報が政府・自治体及び民間事業者から有償あるいは無償で提供されている．
研究・実務に限らず容易に利用できる．
%データ形式の汎用性
データ形式としては，地理情報システムの分野で広く用いられるShapeファイルとして提供されている．
点あるいは線で与えられている環境制約は，
そのままでは観測点への適用に不都合があるので，
バッファ幅を付して用いる．
%利用できないデータ
一方，渋滞のような動的環境制約は測定されていなかったり，
測定されていても非公開で入手できない場合がある．
%我々のスコープ
本研究では,できるだけ多くの都市や地域で利用できるように,
一般に利用可能な環境制約を用いて十分な推定精度を得ることを目指している．
そのため,リアルタイムの渋滞やバスの位置情報は利用していない．

\section{環境制約を用いた移動モード推定}
\subsection{問題設定}
%問題設定
本研究は，観測点$i(x_i, y_i, t_i)$の時系列集合
($x,y$は緯度経度，$t$は時刻)
である旅行者のGPS移動軌跡を入力とし，複数の移動モード$m \in M$(式\ref{mode})の系列として旅行者の行動を出力する事を目的とする．
\begin{equation}
M = \{ m_1, m_2, m_3, \cdots,m_n\}
      \label{mode}
\end{equation}

$M$が旅行者が利用可能な全ての移動モードを含む場合は，全ての$i$に対してラベル$m$が付与できる．
含まない場合はラベル$m$が無い$i$が存在する．
$M$には一般的に徒歩，自転車，バイク，路線バス，路線バス以外の自動車（タクシー，レンタカー，自家用車），列車が含まれる．
旅行者や地域によっては利用できないものもある．


\begin{figure}[htb]
\begin{center}
 \includegraphics[width=70mm]{procedure.eps}
\end{center}
\caption{提案手法の概要}
\label{procedure}
%\ecaption{Procedure}
\end{figure}


\subsection{提案手法の概要}
%提案手法の目的
図\ref{procedure}に提案手法の概要を示す．

%提案手法の手順 前処理
まずGPS移動軌跡への前処理を行う．
GPS移動軌跡には測定誤差が含まれ，
環境制約$e$の適用に支障があるので，
拡張カルマンフィルタと固定区間平滑化法を用いて測定誤差を修正する．
測定誤差を修正した後，
GPS移動軌跡に含まれる緯度経度から速度$v_i$を計算し\cite{nagao}，
観測点$i$が属する速度帯$s_i$を計算する．
速度帯は，全ての移動モードで取り得る上限速度から下限速度(=0)までを適当な数に分割して決定する．
%閾値処理
地下・屋内での移動時や高速移動時には，
拡張カルマンフィルタと固定区間平滑化法でも除去できない異常値が生じることがある．こうした異常値は閾値$u$を設けて対象データから除外する．

%提案手法の手順 環境制約を用いた移動モードの推定
次に，環境制約$e$を用いて観測点$i$の移動モード$m_i$のラベルを推定する．
まず，観測点$i$に環境制約$e$の有無を示す集合$A_i$を付与する．
速度帯$s$と環境制約$e$を組み合わせて，
観測点$i$の移動モード$m_i$のラベルを推定する．
%前後のセグメントのコンテクストを用いた移動モードの推定
複数の移動モードが取り得る速度範囲が類似する観測点では，
移動モード$m_i$が同じ連続する観測点群をセグメント$g$と定義し，
近傍セグメントとの連結性と経路制約を用いて移動モードを推定する．

%出力
最後に，
セグメント$g_j$の開始時刻$b_j$，終了時刻$e_j$，属する観測点の移動モード$m_j$をベクトルとして推定結果を出力する．

\subsection{前処理}
本節ではGPS移動軌跡の測定誤差を修正し，
修正結果にもとづいて速度$v_i$を算出し，
観測点$i$が属する速度帯$s_i$を決定する．

%測定誤差の修正の必要性
GPSは電磁波の伝搬速度，電離層の影響，大気圏の影響といった要因によって測定誤差を生じる．
そのため，GPS移動軌跡をそのまま推定に用いると，速度計算や位置情報に基づいた環境制約の適用に不都合が生じる．
本研究では移動状態を線形離散近似してモデル化し，
入力であるGPS移動軌跡に拡張カルマンフィルタ処理と固定区間平滑化法\cite{durbin}を施して測定誤差を修正する．

%移動軌跡を線形離散時間確率システムとして近似
旅行者は常時一定速度で移動しているわけでは無く，
立ち止まったり急に移動方向を変えたりするので，
その移動は通常非線形モデルであらわされるシステムである．
しかし，1秒程度の短い時間間隔では，移動は線形的であると仮定できるので，
旅行者の移動軌跡は線形離散時間確率システムとして近似できる\cite{nishimura}．
式(\ref{eq:status})に非線形システムとして表した旅行者の状態方程式を，
式(\ref{eq:observation})に観測方程式を示す．
\begin{eqnarray}
{{\bm{x}}_{k+1}} &=& {{\bm{F}}_{k}}{\bm{x}}_{k} + {{\bm{G}}_k}{{\bm{w}}_{k}} \label{eq:status} \\
{{\bm{y}}_{k  }} &=& {{\bm{H}}_{k}}{\bm x}_{k} + {{\bm v}_k}              \label{eq:observation}
\end{eqnarray}

式(\ref{eq:status})の${\bm{x}}_k$は離散時間$k$における旅行者の真の位置，
${\bm{F}}$及び${\bm{G}}$は状態遷移行列及び駆動行列，
${\bm{w}}_k$はシステム雑音である．
式(\ref{eq:observation})の${\bm{v}}_k$は観測雑音，
${\bm{H}}$は観測行列，
${\bm{y}}_k$はGPSで測位された離散時間$k$における旅行者の位置である．
ただし，$\bm{F_k}，\bm{G_k}，\bm{H_k}，{\bm{x}}_0$は$k$によらず一定で既知とする．

拡張カルマンフィルタのアルゴリズムは，
本来非線形であるシステムを線形近似してモデル化し，
そのモデルにカルマンフィルタと同じアルゴリズムを適用することで得られる．
カルマンフィルタは観測値${\bm y}_k$を入力とし，
真の位置${\bm x}_k$の推定値$\hat{\bm x}_{k|k}$を出力する線形確率システムであり，
式(\ref{eq:kalman0})〜(\ref{eq:kalman5})で与えられる．
${K}$はカルマンフィルタゲイン，
$\hat{\bf\Sigma}$は推定誤差の共分散行列である．
初期値$\hat\bf\Sigma_{x_0}$は既知とする．
新しい観測値が得られるたびに古い推定値を修正して新しい推定値を逐次的に計算する．
得られた$\hat{\bm x}_{k|k}$に対して固定区間平滑化を行い，
推定に用いる速度$v_i$を計算するための緯度経度を得る．
\begin{eqnarray}
\label{eq:kalman0}
{\hat {\bm x }  }_{ k|k } &=& { \hat {\bm x }  }_{ k|k-1 } + {\bm K }_{ k }\left( {\bm y}_{ k }  -  {\bm H}_{ k }\left( { \hat {\bm x }  }_{ k|k-1 } \right)  \right) \ \\
\label{eq:kalman1}
{ \hat {\bm x }  }_{ k+1|k } &=& {\bm F }_{ k }\left( { \hat {\bm x }  }_{ k|k } \right) \\
\label{eq:kalman2}
{\bm K }_{ k } &=& \!{ \hat {\bf \Sigma  }  }_{ k|k-1 }{\bm H }_{ k }^{ T }{ \left( {\bm H }_{ k }{ \hat {\bf \Sigma  }  }_{ k|k-1 }{\bm H }_{ k }^{ T } +{\bf \Sigma  }_{ {\bm v }_{ k } } \right)  }^{ -1 }\! \nonumber \\
\\
\label{eq:kalman3}
{ \hat {\bm \Sigma  }  }_{ k|k } &=&{ \hat {\bf \Sigma  }  }_{ k|k-1 } - {\bm K }_{ k }{\bm H }_{ k }{ \hat {\bf \Sigma  }  }_{ k|k-1 } \\
\label{eq:kalman4}
{ \hat {\bf \Sigma  }  }_{ k+1|k } &=& { {\bm F }_{ k }\hat {\bf \Sigma  }  }_{ k|k }{\bm F }_{ k }^{ T } + {\bm G }_{ k }{\bf \Sigma  }_{ {\bm w }_{ k } }{\bm G }_{ k }^{ T } 
\label{eq:kalman5}
\end{eqnarray}

観測点$i$における速度$v_i$は修正後の緯度経度と時刻を用いて算出する．
速度$v_i$は，
緯度経度と時刻から算出した二点$p(x_p,y_p,t_p), q(x_q,y_q,t_q)$間の距離$D(p,q)$と所要時間$t_q-t_p$から算出する．
2点間距離$D$の計算には式(\ref{eq:hubeni})で示すヒュベニの公式を用いる．
\begin{eqnarray}
D(p,q) &=& \sqrt{({d_y} Q)^2 + (N {d_x} cos(a_y) )^2} \nonumber \\
d_y &=& y_p - y_q \nonumber \\
d_x &=& x_p - x_q \nonumber \\
a_y &=& \frac{y_p + y_q}{2} \label{eq:hubeni} 
\end{eqnarray}

式(\ref{eq:hubeni})で$Q$ は子午線曲率半径，$N$は卯酉線曲率半径を表す．
速度$v_i$にもとづいて観測点$i$が属する速度帯$s_i$を決定する．

% Table generated by Excel2LaTeX from sheet 'Sheet2'
\begin{table}[htbp]
  \centering
  \caption{存在確率表の例}
    \begin{tabular}{rrrrr}
    \toprule[1pt]
            & \multicolumn{1}{c}{速度帯} & \multicolumn{1}{c}{ 車両      } & \multicolumn{1}{c}{ 徒歩      } & \multicolumn{1}{c}{ 列車        } \\
    \midrule
    \multicolumn{1}{c}{\multirow{1}[0]{*}{低速}} &  0 - 2 m/秒  & 0.18 & 0.81 & 0.01 \\ \cmidrule(r){2-5}
    \multicolumn{1}{c}{\multirow{4}[0]{*}{中速}} &  2 - 3 m/秒  & 0.96 & 0     & 0.04 \\
    \multicolumn{1}{c}{} &  3 - 4 m/秒  & 0.96 & 0     & 0.04 \\
    \multicolumn{1}{c}{} &  4 - 6 m/秒  & 0.95 & 0     & 0.05 \\
    \multicolumn{1}{c}{} &  6 - 8 m/秒  & 0.96 & 0     & 0.04 \\ \cmidrule(r){2-5}
    \multicolumn{1}{c}{\multirow{4}[0]{*}{高速}} &  8 -10 m/秒  & 0.96  & 0     & 0.04 \\
    \multicolumn{1}{c}{} & 10 -20 m/秒  & 0.94 & 0     & 0.06 \\
    \multicolumn{1}{c}{} & 20 -30 m/秒  & 0.99 & 0     & 0.01 \\
    \multicolumn{1}{c}{} & 30 -50 m/秒  & 0     & 0     & 1 \\
    \bottomrule[1pt]
    \end{tabular}%
  \label{tab:probability}%
\end{table}%

\subsection{環境制約を用いた移動モードの推定}
%本節の概要
本節では環境制約を用いて観測点$i$の移動モード$m_i$のラベルを推定する．
はじめに観測点$i$に全ての環境制約$e$の有無を示す集合$A_i$を付与して$i(x_i, y_i, t_i, s_i, A_i)$とし，
観測点$i$に存在する環境制約$e_i$における各移動モードの存在確率$P_i(m)$を算出する．
速度帯$s_i$において$P_i(m)$が最大となる移動モード$m$を，
観測点$i$の移動モード$m_i$のラベルと推定する．

%存在確率の算出
存在確率$P_i$は人間が移動モードをラベル付けしたデータを訓練データとして算出する.存在確率$P_i$は同じ速度でも環境制約$e$によって異なるので，
式(\ref{eq:probability2})で求める．
\begin{eqnarray}
 P_{i}(m;s,e) = \frac{r_{m,e}(s)}{\sum_{k \in M} r_{k,e}(s)}, m \in M, e \in E \nonumber \\
\label{eq:probability2}
\end{eqnarray}

式(\ref{eq:probability2})で
$s$は観測点が含まれる速度帯，
$m$は移動モード，
$M$は全ての移動モードの集合，
$e$は環境制約，
$E$は全ての環境制約の集合，
$r_{m,e}(s)$は訓練データにおいて,
速度帯が$s$に属し，環境制約$e$が存在する移動モード$m$の観測点数の合計である．
表\ref{tab:probability}に存在確率表の例を示す．

\subsection{コンテクストを用いた移動モードの推定}
次に，速度制約を適用しても移動モードの候補が複数存在する観測点において，
近傍との連結性と経路推定といったコンテクストを用いて移動モードを推定する．
コンテクストを推定に反映させるため，
前節で推定した移動モード$m$が同じ連続する観測点群を統合してセグメントを分割し，
セグメント単位で移動モードを推定する．
なお，速度が類似する移動モードの組み合わせは所与である．
適用した速度制約によって速度変化の地理的時間的な範囲が異なるので，
環境制約の種類に応じた推定方法を用いる．


%点の環境制約
点の環境制約はその近傍において短時間速度を制約するだけで，
制約されたセグメント$g_i$では直前のセグメント$g_{i-1}$の移動モード$m_{i-1}$が連結している．
ただし，点の環境制約が存在する位置で移動モードを乗り換える場合もあり，
この場合は移動モード$m_{i-1}$は連結しない．
乗換と乗換でない場合の差異はセグメントの継続時間にあるので，
セグメント$g_i$の継続時間$d_i$の長さを吟味してから移動モード$m_i$を修正する．
点の環境制約によって速度が制約された時の継続時間$d$の分布は訓練データから知ることができる．
セグメント$g_i$の継続時間$d_i$が分布から外れていなければ，
セグメント$g_i$は環境制約によって生じた一時的速度変化の結果であり，
移動モードは$m_{i-1}$と推定できる．

\begin{figure}[h]
\begin{center}
 \includegraphics[width=70mm]{seg.eps}
\end{center}
\caption{線と面の環境制約による移動モード推定}
\label{seg}
\end{figure}

%線と面の環境制約
線あるいは面の環境制約は比較的長時間にわたって速度を制約するので，
．
セグメント$g_i$の移動モード$m_i$は，
直前のセグメント$g_{i-1}$における移動モード$m_k$を制約する速度制約$e^s_k$と，
セグメント$g_i,g_{i-1}における$経路制約$e^r$を用いて推定する．
まず，移動モード$m_k$の速度のみを制約する速度制約を$e^s_{i-1}$とする．
セグメント$g_i$の移動モードの候補に$m_k$が含まれているとき，
直前のセグメント$g_{i-1}$で速度が$m_k$が取り得る範囲に制約されており，
セグメント$g_{i-1},g_i$において移動モード$m_k$の経路制約$e^r$が存在していれば，
セグメント$g_i$の移動モードは$m_k$と推定される(図\ref{seg})．
なお特定の移動モード$m_k$のみに制約を与える速度制約$e^s_k$と移動モードの組み合わせとしては，
表\ref{tab:probability}で示した駅と列車，バス停と路線バスがあげられる．

\section{実験}
\subsection{実験の概要}
提案手法を評価するために，
実際の旅行者のGPS移動軌跡を対象に移動モードを推定した．
比較対象として，
環境制約を用いず速度のみを用いる手法で移動モード推定を行った．
これを速度法と呼ぶ．
速度法で利用したデータにも拡張カルマンフィルタと固定区間平滑化による測定誤差の修正を行った．


対象者は班別自由行動中の修学旅行生（班長が端末を携帯）及び旅行代理店スタッフ16名である．
この16名のGPS移動軌跡を実験データとした．
実験データは前処理前で288,400，前処理によって異常値を削除した後で287,377の観測点を含む．

実験データは，対象者にGPS携帯情報端末を携帯して一日移動して貰い，
その行動を携帯情報端末にインストールしたGPSロガーアプリケーションで収集した．
ロガーアプリケーションとしては，筆者らが開発したETSS\cite{Kasahara2014}を用いた．

対象者の一日の移動は6時間から10時間程度である．
午前8時以前午後19時以降のデータは含まれていない．

実験地域としては修学旅行生が多数訪れている京都市，大阪市及び奈良市周辺とした．
対象者が利用した移動モード$m$は，徒歩，車両(路線バス及びタクシー)，列車である．
自転車，バイク及び自家用車を利用した対象者はいない．

これら実験データから1データを引き出して評価データとし，
残りを訓練データとするleave-one-out交差検証を用いて提案手法を評価した．

\subsection{環境制約}
環境制約としては，駅，列車経路，路線バス経路，車両専用道路，徒歩専用地域の5つを用いた(図\ref{envt})．
駅，列車経路及び車両専用道路はインクリメントP社が提供する京都市周辺の列車及び道路のデータを用いた．
バス経路は国土地理院が提供する国土数値情報バスルートに含まれる京都市交通局バス経路データを利用した．
徒歩専用地域は京都市から提供を受けた観光地約200ヶ所のポリゴンデータを用いた．
列車経路と車両専用道路には40m，
バス経路には20m，
バス停には5mのバッファを与えた．
徒歩専用地域は矩形として与えられるのでバッファは与えていない．

\begin{figure}[htb]
\begin{center}
 \includegraphics[width=70mm]{env.eps}
\end{center}
\caption{実験で用いた環境制約}
\label{envt}
%\ecaption{Environmental Constraints}
\end{figure}

\subsection{前処理}
異常値を除去するための速度の閾値$u$は，
実験地域における最高速の交通手段であるJR西日本の快速列車の速度を参考に$50m$毎秒とした．
新幹線に乗車したデータは含まれていない．

\subsection{環境制約を用いた移動モードの推定}
地理空間上の位置によっては環境制約が重複して存在する場合がある．
本実験では環境制約に優先度を与え，
重複する場合は最も優先度の高い環境制約に基づいた存在確率$P_i$を観測点$i$に付与した．
以下に降順で例示するように，
特定の移動モードの必要条件となるものを優先した．\\

\begin{enumerate}
  \item 列車経路
  \item バス経路
  \item 車両専用道路
  \item 徒歩専用地域\\
\end{enumerate}

\subsection{コンテクストを用いた移動モードの推定}
路線バスとタクシーの両モードは，取り得る速度の範囲が類似しており，
観測点の速度では推定が難しいので，
路線バスとタクシーの両モードを一括で車両モードと推定した後，
路線バスの経路制約と点の速度制約をセグメントに適用して推定結果を修正した．
経路制約としては路線バス経路，
点の速度制約としてはバス停を利用した．

バス停の位置情報は国土地理院が提供しているが，
環境制約として利用するには位置情報の精度が十分でなかったので,
本研究ではバス停への停車を訓練データから推定した．
バス停への停車は,他の移動軌跡において,
路線バスが推定対象セグメント近傍において停車しているかを基準に推定した．
他の移動軌跡としては訓練データを用いた．
停車の基準は速度が秒速2m以下の時とした．

\begin{figure}[t]
\begin{center}
 \includegraphics[width=70mm]{res.eps}
\end{center}
\caption{実験結果}
\label{res}
\end{figure}


\subsection{実験結果}
提案手法の実験結果を表\ref{tab:result1}に示す．
提案手法による推定結果は正解データに対して軌跡全体で91.5\%の再現率となった．
速度法では75.0\%（表\ref{tab:resultvel})の再現率となった．
提案手法における移動モード別再現率は徒歩モードが97.0\%，
列車モードが89.9\%，
タクシーモードが78.1\%，
路線バスモードが66.8\%である．
速度法ではセグメント数は3,599となったが，
提案手法により494まで統合された．
正解データでは122である．
推定結果の例を実際の地図上にプロットしたものを図\ref{res}に示す．

\begin{table}[htb]
  \begin{center}
    \caption{提案手法の推定結果 (再現率91.5\%)}
    \begin{tabular}{l|ccccc}
      \multicolumn{1}{l|}{}
      &  \multicolumn{4}{c}{正解}\\
            & 路線バス & タクシー & 列車     & 徒歩      \\ 
   推定     & n=18,768 & n=41,218 & n=33,682 & n=193,721 \\ \hline
   路線バス & 66.8\%   & 4.8\%    & 0.0\%    & 0.1\%     \\
   タクシー & 21.2\%   & 78.1\%   & 3.2\%    & 2.7\%     \\
   列車     & 0.7\%    & 2.7\%    & 89.9\%   & 0.2\%     \\
   徒歩     & 11.3\%   & 14.4\%   & 6.8\%    & 97.0\%    \\
   \end{tabular}
   \label{tab:result1}
 \end{center}
\end{table}

\begin{table}[htb]
  \begin{center}
    \caption{環境制約を使わない速度法での推定結果 \\ (再現率 73.5\%)}
    \begin{tabular}{l|ccccc}
      \multicolumn{1}{l|}{}
      &  \multicolumn{4}{c}{正解}\\
            & 路線バス & タクシー & 列車     & 徒歩      \\ 
   推定     & n=18,768 & n=41,218 & n=33,682 & n=193,721 \\ \hline
   路線バス & 0.6\%    & 9.7\%    & 1.2\%    & 0.6\%     \\
   タクシー & 52.5\%   & 26.4\%   & 47.0\%   & 1.3\%     \\
   列車     & 0.5\%    & 38.2\%   & 30.8\%   & 0.1\%     \\
   徒歩     & 46.4\%   & 25.8\%   & 21.1\%   & 98.0\%    \\
    \end{tabular}
    \label{tab:resultvel}
  \end{center}
\end{table}


\section{考察}
GPS移動軌跡に環境制約を用いて旅行者の移動モードを推定し，91.5\%の結果を得た．
観測点に対する環境制約を用いた推定で得られた推定率は86.8\%，
セグメント数は1,875である．
但し,観測点に対する推定の対象となる移動モードは徒歩，車両，列車の3モードである．
この結果にセグメントのコンテクストを用いた推定を行うことにより91.5\%の推定率を得た.
速度法で得た推定率を基準とすると，
観測点に対する環境制約を用いた推定による効果は+13.3\%，
セグメントのコンテクストを用いた推定による効果は+4.7\%である.

提案手法ではセグメント数の推定精度が大幅に向上しており
速度のみで推定した速度法の3,599よりも正解の212に非常に近い494まで統合された．
これは駅やバス停など点の移動制約を考慮して速度を解釈した推定したため，
速度法では低速移動モードを用いた短いセグメントと推定されたセグメントが正しく近傍に統合された結果である．
図\ref{res}に示したとおり人間の直感にも合致しており，
実用に供しうる推定結果を得ることができた．

これ以上の推定率を向上を図る場合はGPSの精度が問題になる.
マルチパスなどによって公称精度よりも大きい誤差が生じた場合，
誤差を考慮して環境制約にバッファを付しても,
観測点に適切な環境制約を適用できなくなる.
また，本研究では静的な環境制約しか考慮していないが，
実空間には渋滞など動的な環境制約が存在している.
今回利用した実験データは，
修学旅行という旅行の性質上，
徒歩の利用頻度が高いため渋滞の影響は小さかったが，
路線バスやタクシーといった車両の利用頻度が大きい実験データに対して提案手法を適用した場合，
動的環境制約の影響が大きくなる可能性がある.

\section{まとめ}
本研究では，旅行者の移動に関する環境制約を用いたGPS移動軌跡からの移動モード推定を提案した．
都市におけるセンシング環境やセンシングデータび利用ルールが整備されていないため，
公共交通機関のリアルタイム位置情報や渋滞情報が利用しにくく，
こうした情報を用いた動的環境制約が利用できなかった面がある．
IoT(Internet of Things) の進展に伴い，
今回利用できなかった動的環境制約に関する情報が利用できるようになれば，
更に精度の向上が可能と考える．
リアルタイム情報以外にも，
バス停や観光地など公共に属する地理空間情報の入手や利用にも制約が大きい．
リンクドオープンデータ(LOD)の枠組みでこうした状況が解決する事を期待したい．

\ack %% 謝辞
本研究を行うにあたり実験に協力を頂いた各学校，並びに近畿日本ツーリストと復興教育支援ネットワーク(RAiSE)に感謝する．

%\bibliographystyle{sieicej}
%\bibliography{myrefs}
\begin{thebibliography}{99}% 文献数が10未満の時 {9}
\bibitem{Guc}
Guc, B., May, M., Saygin, Y., Korner, C. (2008). Semantic annotation of GPS trajectories. In 11th AGILE International Conference on Geographic Information Science.

%\bibitem{Yan2010}
%Yan, Z., Parent, C., Spaccapietra, S.,  Chakraborty, D. (2010). A hybrid model and computing platform for spatio-semantic trajectories. In The Semantic Web: Research and Applications (pp. 60-75). Springer Berlin Heidelberg.

%\bibitem{Yan2011}
%Yan, Z., Chakraborty, D., Parent, C., Spaccapietra, S.,  Aberer, K. (2011, March). SeMiTri: a framework for semantic annotation of heterogeneous trajectories. In Proceedings of the 14th international conference on extending database technology (pp. 259-270). ACM.

\bibitem{Hemminki}
Hemminki, S., Nurmi, P., Tarkoma, S. (2013, November). Accelerometer-based transportation mode detection on smartphones. In Proceedings of the 11th ACM Conference on Embedded Networked Sensor Systems (p. 13). ACM.

\bibitem{Bolbol}
Bolbol, A., Cheng, T., Tsapakis, I.,  Haworth, J. (2012). Inferring hybrid transportation modes from sparse GPS data using a moving window SVM classification. Computers, Environment and Urban Systems, 36(6), 526-537.

\bibitem{Aoki}
青木政勝, 瀬古俊一, 西野正彬, 山田智広, 武藤伸洋,  阿部匡伸. (2008). ライフログのための位置情報ログデータからの移動モード判定の検討 (ライフログ活用技術とその課題, オフィス情報システム, デジタルドキュメント, 一般). 電子情報通信学会技術研究報告. OIS, オフィスインフォメーションシステム, 108(156), 7-12.

\bibitem{Zheng}
Zheng, Y., Chen, Y., Li, Q., Xie, X.,  Ma, W. Y. (2010). Understanding transportation modes based on GPS data for web applications. ACM Transactions on the Web (TWEB), 4(1), 1.

\bibitem{Liao}
Liao, L., Fox, D.,  Kautz, H. (2007). Extracting places and activities from gps traces using hierarchical conditional random fields. The International Journal of Robotics Research, 26(1), 119-134.

\bibitem{ohashi}
大橋洋輝, 秋山高行, 山本正明, 佐藤暁子. (2015). 車両走行時の振動発生モデルに基づく移動手段識別方式. 情報処理学会論文誌, 56(1), 23-34.

\bibitem{Stenneth}
Stenneth, L., Wolfson, O., Yu, P. S.,  Xu, B. (2011). Transportation mode detection using mobile phones and GIS information. ACM SIGSPATIAL GIS ‘11, November 1-4, 2011. Chicago, IL, USA.
Stopher,

\bibitem{Yan2013}
Yan, Z., Chakraborty, D., Parent, C., Spaccapietra, S.,  Aberer, K. (2013). Semantic trajectories: Mobility data computation and annotation. ACM Transactions on Intelligent Systems and Technology (TIST), 4(3), 49.

\bibitem{nishimura}
西村徳成, 佐々木実, 伊藤聡, 小串直樹. (2011). 拡張カルマンフィルタを用いた GPS データのスムージング. 日本 AEM 学会誌, 19(3), 591-598.

%\bibitem{Cao}
%Cao, X., Cong, G.,  Jensen, C. S. (2010). Mining significant semantic locations from gps data. Proceedings of the VLDB Endowment, 3(1-2), 1009-1020.

%\bibitem{Furletti}
%Furletti, B., Cintia, P., Renso, C.,  Spinsanti, L. (2013, August). Inferring human activities from GPS tracks. In Proceedings of the 2nd ACM SIGKDD International Workshop on Urban Computing (p. 5). ACM.

%\bibitem{Stopher}
%Stopher, P., Clifford, E, Zhang, J.,  FitzGerald, C. (2008). Deducing mode and purpose from GPS data. In The 87th annual meeting of the transportation research board, Washington, DC, United States.

\bibitem{nagao}
Nagao, M., Kawamura, H., Yamamoto, M., Ohuchi, A. (2006). Analysis of circular tour activity based on GPS Log. Information and Communication Technologies in Tourism 2006, 87-98.

\bibitem{Kasahara2014}
Kasahara, H., Kurumatani, K., Mori, M., Mukunoki, M., Minoh, M. (2014). Evacuation support and safety confirmation sharing in disaster situations for school trips by mobile information system. Information Technology \& Tourism, 14(3), 197-217.

\bibitem{Kasahara2014a}
笠原秀一，森幹彦，椋木雅之，美濃導彦. (2014). GPS移動軌跡を利用した観光行動における移動・滞在モード推定，第11回観光情報学会全国大会講演論文集

%\bibitem{Furukawa}
%古川侑紀, 西山勇毅, 大越匡, 中澤仁, 高汐一紀, 徳田英幸. (2014). 加速度センサのみを用いた移動手段判定アルゴリズムの評価. 情報処理学会研究報告. MBL,[モバイルコンピューティングとユビキタス通信研究会研究報告], 2014(43), 1-7.

\bibitem{durbin}
Durbin, J., Koopman, S. J. (2012). Time series analysis by state space methods (No. 38). Oxford University Press.

\end{thebibliography}

\end{document}







\begin{eqnarray}
Q_i\sum_{j}d_i(j)\sum_+(N×\cos(P)×dR)×(N×\cos(P)×dR))^2 \\
\label{eq:tekigo}
\end{eqnarray}



\begin{figure}[tb]
\begin{center}
 \includegraphics[width=60mm]{fig3.eps}
\end{center}
\caption{路線バスの一時的減速}
\label{fig3}
%\ecaption{}
\end{figure}
しかし，観測対象に属する特徴量に加えて環境側の特徴量に注目した手法を論じた研究はあまり行われていない．


なお，駅の場所や路線バスの経路のように，環境制約の多くは公開情報として容易に入手できるが，渋滞情報のように入手が難しいものもある．このように環境制約の情報が利用できない場合，提案手法ではGPS移動軌跡に含まれている緯度経度と時刻から速度を計算し，速度の時系列変化から移動モードを推定する．



%図\ref{gensoku}で示すように，列車や車両が駅や交差点で一時的に加減速$/$停止するため，速度だけでは本来移動モード$m_3$である観測点$i_{n}$〜$i_{n+4}$の一時的な加減速や停止を，より低速の別の移動モード$m_1$あるいは$m_2$に誤推定する問題が避けられない．
%しかし，観測点$i_{n}$〜$i_{n+4}$に存在する環境制約$e$が速度に制約を与えて一時的な加減速が生じる事が既知であれば，加減速や停止時でも観測点$i_{n}$〜$i_{n+4}$の移動モード$m_3$を正しく推定できる．

%なお，環境制約がない場合$(e=\emptyset)$もある．

環境制約に関する情報が利用できない場合，
環境制約に関する情報が利用できない場合とは，
渋滞のように殆ど測定されていない等の理由から情報の入手がそもそも難しい場合と，
旅行者の小休止や交通信号といった理由から，既知の場所以外で一時的加減速が生じた場合の二つがある．
このような場合，GPS移動軌跡から得られる速度の時系列変化を用いて移動モードを推定する．


\begin{table}[bht]
  \begin{center}
    \caption{環境制約が無い場合の存在確率}
    \begin{tabular}{llll|}
       & 速度クラス & 車両      & 徒歩      & 列車        \\ \hline
低速   & 0 - 2 m/秒 & 0.1844588 & 0.8102307 & 0.005310478 \\ 
       & 2 - 3 m/秒 & 0.9646870 & 0.0000000 & 0.035313002 \\ 
中速   & 3 - 4 m/秒 & 0.9568966 & 0.0000000 & 0.043103448 \\ 
       & 4 - 6 m/秒 & 0.9540567 & 0.0000000 & 0.045943304 \\ 
       & 6 - 8 m/秒 & 0.9584514 & 0.0000000 & 0.041548631 \\ 
       & 8 -10 m/秒 & 0.9600000 & 0.0000000 & 0.040000000 \\ 
       &10 -20 m/秒 & 0.9422383 & 0.0000000 & 0.057761733 \\ 
       &20 -30 m/秒 & 0.9858871 & 0.0000000 & 0.014112903 \\ 
       &30 -50 m/秒 & 0.0000000 & 0.0000000 & 1.000000000 \\ 
    \end{tabular}
    \label{tab:probability}
  \end{center}
\end{table}

%存在確率$P_i$はある環境制約内において速度毎に移動モードが存在する確からしさである．
%本研究では，推定対象データを含まない移動軌跡データに，
%訓練データにも拡張カルマンフィルタと固定区間平滑化による誤差修正を行い，



次に，速度制約を用いて移動モード$m_i$を推定する．
車両や列車は一定の速度で移動し，短時間で移動モードは変化しないが，
バス停や駅では一時的加減速を行う．

%継続性の仮定を利用するため，
%まず全ての観測点$i$について，移動モード$m_i$が連続する観測点群をセグメント$g$と定義する．
%図\ref{gensoku}では，$i_{m}$,$i_{m+1}$〜$i_{m+2}$,$i_{m+3}$〜$i_{m+4}$はそれぞれ別のセグメントとなる．\par

%\begin{figure}[bht]
%\begin{center}
% \includegraphics[width=70mm]{gensokurev2.eps}
%\end{center}
%\caption{セグメント}
%\label{gensoku}
%\ecaption{Likelihood of Segment Length}
%\end{figure}
存在確率$P_i$は同じ速度でも属性$A_i$によって異なるので式(\ref{eq:probability2})で求める．

存在確率$P_i$が最大となる移動モード$m$を観測点$i$の移動モード$m_i$のラベルと推定する．\par


%\subsection{継続性の仮定による移動モードの修正}
%本節では継続性の仮定にもとづいて移動モード$m_i$を修正する．
%継続性の仮定によれば旅行者は短い継続時間では移動モードを変えないので，
%あるセグメント$g$の継続時間$l_g$が継続性の仮定を満たすほど短かければ，
%$g$に属する観測点の移動モード$m_g$を前後いずれかのセグメントの移動モードに修正する．
%セグメントの継続時間$l_g$の判定には，
%継続時間$l_g$を変数とする移動モードの存在尤度$h(l)$と，
%セグメント$g$後一定の時間間隔$q$におけるセグメント変化数$d(g)$を用いる．
%修正する移動モードは，連続するセグメント$k$と比較して決定する．
%連続するセグメント$k$の方が継続時間が短い場合があるため，
%一概にセグメント$k$の移動モード$m_k$には決定しない．
%
%継続時間$l_g$を変数とする移動モードの存在尤度$h(l)$
%まず，
%移動モードの存在尤度$h(l)$を用いる場合について述べる．
%移動モードの存在尤度$h(l)$は人間が移動モード$m$をラベル付けした訓練データを用いて算出する．
%訓練データに属する全てのセグメントについて，
%開始時刻$b$，終了時刻$e$，属する観測点の移動モード$m$を計算し，
%セグメントの集合$(b_g, e_g, m_g), g \in G (Gは全てのセグメント)$を得る．
%これを$l_g$について昇順に並べて尤度関数$h(l)$を推定する．
%$l_g$は離散的なので算出にはカーネル密度推定を用いる．
%移動モードの存在尤度$h(l)を用いたl_gの判定
%推定した尤度関数$h(l)$を用いて，
%セグメント$g$の継続時間$l_g$が継続性の仮定を満たすほど短いかを判定する．
%連続するセグメント$g,k$を統合したセグメントの継続時間について，
%$h(l_{g}+l_{k}) > h(l_g)$ならば，
%$l_g$は短いと判定する．
%
%修正する移動モードの決定
%セグメントの移動モード$m$は尤度$h$の大きいセグメントに合わせて修正する．
%$h(l_{g}) < h(l_{k})$ならば，
%セグメント$g$に属する観測点をセグメント$k$に属する観測点の移動モード$m_k$に修正する．
%$h(l_{g}) > h(l_{k})$ならば，
%セグメント$k$に属する観測点をセグメント$g$に属する観測点の移動モード$m_g$に修正する．
%
%セグメント変化数
%次に，
%セグメント変化数$d(g)$を用いる場合について述べる．
%セグメント$g$に続く時間間隔$q$におけるセグメント変化数を$d(g,q)$で表す．
%時間間隔$q$は定数として与える．
%連続するセグメント$g, k$を統合したセグメント$g+k$において，
%セグメント変化数$d(g+k)$が$d(g+k) < d(g))$ならば，
%セグメント$g$は短いと判定する．
%修正する移動モードの決定
%セグメントの移動モード$m$は継続時間$d$が長いセグメントに合わせて修正する．
%$l(g) < l(k)$ならば，
%セグメント$g$に属する観測点の移動モード$m_g$を移動モード$m_k$に修正する．


点の環境制約である駅やバス停近傍における徒歩と鉄道/路線バスや，
線の環境制約である一般道を走行中のタクシー/路線バスがこれに該当する．
